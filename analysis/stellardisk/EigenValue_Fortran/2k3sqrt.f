      function Q(r)
      DOUBLE PRECISION  Q,r
      Q = 1.d0 + 0.75d0*dexp(-r**2)
      endfunction

      function nu(r,wr,wi)
      IMPLICIT NONE
      DOUBLE COMPLEX    nu   
      DOUBLE PRECISION  wr,wi,r

      nu =
     - (-2*Sqrt(4332.198668720216/(1 + 0.32653061224489793*r**2)**1.5 + 
     -       (16*(49.763968707502585*
     -             (59.0625/(1 + r**2/144.)**5.5 + 
     -               26.25/(1 + r**2/144.)**4.5 + 
     -               16.875/(1 + r**2/144.)**3.5 + 
     -               11.25/(1 + r**2/144.)**2.5 + 
     -               6.5625/(1 + r**2/144.)**1.5) - 
     -            41.988348596955305*
     -             (59.0625/(1 + r**2/64.)**5.5 + 
     -               26.25/(1 + r**2/64.)**4.5 + 
     -               16.875/(1 + r**2/64.)**3.5 + 
     -          11.25/(1 + r**2/64.)**2.5 + 6.5625/(1 + r**2/64.)**1.5)
     -            ))/105.) + (0,1)*wi + wr)/
     -(2.*Sqrt((4332.198668720216/(1 + 0.32653061224489793*r**2)**1.5 + 
     -        (16*(49.763968707502585*
     -              (59.0625/(1 + r**2/144.)**5.5 + 
     -                26.25/(1 + r**2/144.)**4.5 + 
     -                16.875/(1 + r**2/144.)**3.5 + 
     -                11.25/(1 + r**2/144.)**2.5 + 
     -                6.5625/(1 + r**2/144.)**1.5) - 
     -             41.988348596955305*
     -              (59.0625/(1 + r**2/64.)**5.5 + 
     -                26.25/(1 + r**2/64.)**4.5 + 
     -                16.875/(1 + r**2/64.)**3.5 + 
     -           11.25/(1 + r**2/64.)**2.5 + 6.5625/(1 + r**2/64.)**1.5
     -                )))/105.)*
     -      (1 + (r*((-4243.786450991232*r)/
     -              (1 + 0.32653061224489793*r**2)**2.5 + 
     -             (16*(49.763968707502585*
     -                   ((-4.51171875*r)/(1 + r**2/144.)**6.5 - 
     -                     (1.640625*r)/(1 + r**2/144.)**5.5 - 
     -                     (0.8203125*r)/(1 + r**2/144.)**4.5 - 
     -                     (0.390625*r)/(1 + r**2/144.)**3.5 - 
     -                     (0.13671875*r)/(1 + r**2/144.)**2.5) - 
     -                  41.988348596955305*
     -                   ((-10.1513671875*r)/(1 + r**2/64.)**6.5 - 
     -                     (3.69140625*r)/(1 + r**2/64.)**5.5 - 
     -                     (1.845703125*r)/(1 + r**2/64.)**4.5 - 
     -                     (0.87890625*r)/(1 + r**2/64.)**3.5 - 
     -                (0.3076171875*r)/(1 + r**2/64.)**2.5)))/105.))/
     -    (4.*(4332.198668720216/(1 + 0.32653061224489793*r**2)**1.5 + 
     -             (16*(49.763968707502585*
     -                   (59.0625/(1 + r**2/144.)**5.5 + 
     -                     26.25/(1 + r**2/144.)**4.5 + 
     -                     16.875/(1 + r**2/144.)**3.5 + 
     -                     11.25/(1 + r**2/144.)**2.5 + 
     -                     6.5625/(1 + r**2/144.)**1.5) - 
     -                  41.988348596955305*
     -                   (59.0625/(1 + r**2/64.)**5.5 + 
     -                     26.25/(1 + r**2/64.)**4.5 + 
     -                     16.875/(1 + r**2/64.)**3.5 + 
     -                     11.25/(1 + r**2/64.)**2.5 + 
     -                     6.5625/(1 + r**2/64.)**1.5)))/105.)))))
      
      endfunction

      function k3sqrt(r,wr,wi)
      IMPLICIT NONE
      DOUBLE COMPLEX            k3sqrt
      DOUBLE COMPLEX,EXTERNAL   ::nu
      DOUBLE PRECISION,INTENT(in)::r,wr,wi
      DOUBLE PRECISION          ::rr
      DOUBLE PRECISION,EXTERNAL ::KappaOverASqr,Q,curF
        
      k3sqrt = KappaOverASqr(r)*(Q(r)**(-2) - 1.d0 + nu(r,wr,wi)**2)
!     rr = r +0.0000000001d0
!     k3sqrt = KappaOverASqr(rr)*(Q(rr)**(-2) - 1.d0 +
!    c nu(rr,wr,wi)**2+0.25d0*curF(rr)**2*q(rr)**2)


      endfunction

      function KappaOverASqr(r)
      IMPLICIT NONE
      DOUBLE PRECISION            KappaOverASqr
      DOUBLE PRECISION            r
      
      KappaOverASqr =       
     -  (8.769255739407259e10*(4332.198668720216/
     -        (1 + 0.32653061224489793*r**2)**1.5 + 
     -       (16*(49.763968707502585*
     -             (59.0625/(1 + r**2/144.)**5.5 + 
     -               26.25/(1 + r**2/144.)**4.5 + 
     -               16.875/(1 + r**2/144.)**3.5 + 
     -               11.25/(1 + r**2/144.)**2.5 + 
     -               6.5625/(1 + r**2/144.)**1.5) - 
     -            41.988348596955305*
     -             (59.0625/(1 + r**2/64.)**5.5 + 
     -               26.25/(1 + r**2/64.)**4.5 + 
     -               16.875/(1 + r**2/64.)**3.5 + 
     -        11.25/(1 + r**2/64.)**2.5 + 6.5625/(1 + r**2/64.)**1.5)
     -            ))/105.)**2*(1 + 
     -       (r*((-4243.786450991232*r)/
     -             (1 + 0.32653061224489793*r**2)**2.5 + 
     -            (16*(49.763968707502585*
     -                  ((-4.51171875*r)/(1 + r**2/144.)**6.5 - 
     -                    (1.640625*r)/(1 + r**2/144.)**5.5 - 
     -                    (0.8203125*r)/(1 + r**2/144.)**4.5 - 
     -                    (0.390625*r)/(1 + r**2/144.)**3.5 - 
     -                    (0.13671875*r)/(1 + r**2/144.)**2.5) - 
     -                 41.988348596955305*
     -                  ((-10.1513671875*r)/(1 + r**2/64.)**6.5 - 
     -                    (3.69140625*r)/(1 + r**2/64.)**5.5 - 
     -                    (1.845703125*r)/(1 + r**2/64.)**4.5 - 
     -                    (0.87890625*r)/(1 + r**2/64.)**3.5 - 
     -              (0.3076171875*r)/(1 + r**2/64.)**2.5)))/105.))/
     -   (4.*(4332.198668720216/(1 + 0.32653061224489793*r**2)**1.5 + 
     -            (16*(49.763968707502585*
     -                  (59.0625/(1 + r**2/144.)**5.5 + 
     -                    26.25/(1 + r**2/144.)**4.5 + 
     -                    16.875/(1 + r**2/144.)**3.5 + 
     -                    11.25/(1 + r**2/144.)**2.5 + 
     -                    6.5625/(1 + r**2/144.)**1.5) - 
     -                 41.988348596955305*
     -                  (59.0625/(1 + r**2/64.)**5.5 + 
     -                    26.25/(1 + r**2/64.)**4.5 + 
     -                    16.875/(1 + r**2/64.)**3.5 + 
     -                    11.25/(1 + r**2/64.)**2.5 + 
     -                    6.5625/(1 + r**2/64.)**1.5)))/105.)))**2)

      KappaOverASqr = KappaOverASqr/
     -  ((1 + 0.75/exp(1.)**r**2)**2*
     -    (1.9894367886486915e8/(1 + r**2/144.)**5.5 - 
     -       1.1190581936148891e8/(1 + r**2/64.)**5.5)**2)

      endfunction

      function kappa(r)
      DOUBLE PRECISION  kappa,r

      kappa = 
     -  2*Sqrt((4332.198668720216/(1 + 0.32653061224489793*r**2)**1.5 + 
     -      (16*(49.763968707502585*
     -            (59.0625/(1 + r**2/144.)**5.5 + 
     -              26.25/(1 + r**2/144.)**4.5 + 
     -              16.875/(1 + r**2/144.)**3.5 + 
     -          11.25/(1 + r**2/144.)**2.5 + 6.5625/(1 + r**2/144.)**1.5
     -              ) - 41.988348596955305*
     -            (59.0625/(1 + r**2/64.)**5.5 + 
     -              26.25/(1 + r**2/64.)**4.5 + 
     -              16.875/(1 + r**2/64.)**3.5 + 
     -          11.25/(1 + r**2/64.)**2.5 + 6.5625/(1 + r**2/64.)**1.5))
     -         )/105.)*(1 + (r*
     -         ((-4243.786450991232*r)/
     -            (1 + 0.32653061224489793*r**2)**2.5 + 
     -           (16*(49.763968707502585*
     -                 ((-4.51171875*r)/(1 + r**2/144.)**6.5 - 
     -                   (1.640625*r)/(1 + r**2/144.)**5.5 - 
     -                   (0.8203125*r)/(1 + r**2/144.)**4.5 - 
     -                   (0.390625*r)/(1 + r**2/144.)**3.5 - 
     -                   (0.13671875*r)/(1 + r**2/144.)**2.5) - 
     -                41.988348596955305*
     -                 ((-10.1513671875*r)/(1 + r**2/64.)**6.5 - 
     -                   (3.69140625*r)/(1 + r**2/64.)**5.5 - 
     -                   (1.845703125*r)/(1 + r**2/64.)**4.5 - 
     -                   (0.87890625*r)/(1 + r**2/64.)**3.5 - 
     -               (0.3076171875*r)/(1 + r**2/64.)**2.5)))/105.))/
     -    (4.*(4332.198668720216/(1 + 0.32653061224489793*r**2)**1.5 + 
     -           (16*(49.763968707502585*
     -                 (59.0625/(1 + r**2/144.)**5.5 + 
     -                   26.25/(1 + r**2/144.)**4.5 + 
     -                   16.875/(1 + r**2/144.)**3.5 + 
     -                   11.25/(1 + r**2/144.)**2.5 + 
     -                   6.5625/(1 + r**2/144.)**1.5) - 
     -                41.988348596955305*
     -                 (59.0625/(1 + r**2/64.)**5.5 + 
     -                   26.25/(1 + r**2/64.)**4.5 + 
     -                   16.875/(1 + r**2/64.)**3.5 + 
     -                   11.25/(1 + r**2/64.)**2.5 + 
     -                   6.5625/(1 + r**2/64.)**1.5)))/105.))))


      ENDFUNCTION

        function error(r,wr,wi)
        IMPLICIT NONE
        DOUBLE COMPLEX          ::error
        DOUBLE COMPLEX,EXTERNAL ::k3sqrt
        DOUBLE PRECISION,INTENT(in)::r,wr,wi
        DOUBLE PRECISION        ::h=10d-15

        error  = -(0.d0,1.d0)*sqrt(k3sqrt(r,wr,wi))
        error  = error -
     c  0.5d0/sqrt(k3sqrt(r,wr,wi))
     c *(sqrt(k3sqrt(r+h,wr,wi))-sqrt(k3sqrt(r-h,wr,wi)))/(2.d0*h)

        endfunction

        function find_b(wr)
        IMPLICIT NONE
        DOUBLE PRECISION        find_b,wr
        DOUBLE PRECISION        ::B,C,i,RE,AE
        DOUBLE PRECISION,EXTERNAL::kappa
        INTEGER                 ::IFLAG

        B = 0.d0
        C = 10.d0
        I = B
        

        CALL DFZERO(F,B,C,I,RE,AE,IFLAG)
        find_b = b

        CONTAINS

        FUNCTION F(r)
        DOUBLE PRECISION        ::F,r
        F = wr - 
     -  2*Sqrt(4332.198668720216/
     -     (1 + 0.32653061224489793*r**2)**1.5 + 
     -    (16*(49.763968707502585*
     -          (59.0625/(1 + r**2/144.)**5.5 + 
     -            26.25/(1 + r**2/144.)**4.5 + 
     -            16.875/(1 + r**2/144.)**3.5 + 
     -            11.25/(1 + r**2/144.)**2.5 + 
     -            6.5625/(1 + r**2/144.)**1.5) - 
     -         41.988348596955305*
     -          (59.0625/(1 + r**2/64.)**5.5 + 
     -            26.25/(1 + r**2/64.)**4.5 + 
     -            16.875/(1 + r**2/64.)**3.5 + 
     -            11.25/(1 + r**2/64.)**2.5 + 
     -            6.5625/(1 + r**2/64.)**1.5)))/105.)

       F = F /kappa(r) -0.5d0
        ENDFUNCTION

        endfunction

        FUNCTION mo(r)
        DOUBLE PRECISION          ::mo,r
        mo = 
     -  2*Sqrt(4332.198668720216/
     -     (1 + 0.32653061224489793*r**2)**1.5 + 
     -    (16*(49.763968707502585*
     -          (59.0625/(1 + r**2/144.)**5.5 + 
     -            26.25/(1 + r**2/144.)**4.5 + 
     -            16.875/(1 + r**2/144.)**3.5 + 
     -            11.25/(1 + r**2/144.)**2.5 + 
     -            6.5625/(1 + r**2/144.)**1.5) - 
     -         41.988348596955305*
     -          (59.0625/(1 + r**2/64.)**5.5 + 
     -            26.25/(1 + r**2/64.)**4.5 + 
     -            16.875/(1 + r**2/64.)**3.5 + 
     -            11.25/(1 + r**2/64.)**2.5 + 
     -            6.5625/(1 + r**2/64.)**1.5)))/105.)
        ENDFUNCTION

        FUNCTION curF(r)
        IMPLICIT NONE
        DOUBLE  PRECISION       ::curF,r
        curF = 
     -  (0.00007641060048193885*
     -    (-9.612636687793569e17/(64 + r**2)**5.5 + 
     -      1.4781681869206313e20/(144 + r**2)**5.5))/
     -  (r*(4332.198668720216/
     -       (1 + 0.32653061224489793*r**2)**1.5 - 
     -      3.2460945126654697e12/(64 + r**2)**5.5 - 
     -      2.254232300462132e10/(64 + r**2)**4.5 - 
     -      2.264295837517766e8/(64 + r**2)**3.5 - 
     -      2.35864149741434e6/(64 + r**2)**2.5 - 
     -      21498.03448164112/(64 + r**2)**1.5 + 
     -      3.3277540777497106e14/(144 + r**2)**5.5 + 
     -      1.0270845918980587e12/(144 + r**2)**4.5 + 
     -      4.585199070973476e9/(144 + r**2)**3.5 + 
     -      2.1227773476729058e7/(144 + r**2)**2.5 + 
     -      85992.13792656448/(144 + r**2)**1.5)*
     -    (4 + (r**2*(-4243.786450991232/
     -            (1 + 0.32653061224489793*r**2)**2.5 + 
     -           3.5707039639320164e13/(64 + r**2)**6.5 + 
     -           2.0288090704159186e11/(64 + r**2)**5.5 + 
     -           1.5850070862624364e9/(64 + r**2)**4.5 + 
     -           1.1793207487071699e7/(64 + r**2)**3.5 + 
     -           64494.10344492335/(64 + r**2)**2.5 - 
     -           3.6605294855246815e15/(144 + r**2)**6.5 - 
     -           9.24376132708253e12/(144 + r**2)**5.5 - 
     -           3.2096393496814335e10/(144 + r**2)**4.5 - 
     -           1.061388673836453e8/(144 + r**2)**3.5 - 
     -           257976.41377969345/(144 + r**2)**2.5))/
     -       (4332.198668720216/
     -          (1 + 0.32653061224489793*r**2)**1.5 - 
     -         3.2460945126654697e12/(64 + r**2)**5.5 - 
     -         2.254232300462132e10/(64 + r**2)**4.5 - 
     -         2.264295837517766e8/(64 + r**2)**3.5 - 
     -         2.35864149741434e6/(64 + r**2)**2.5 - 
     -         21498.03448164112/(64 + r**2)**1.5 + 
     -         3.3277540777497106e14/(144 + r**2)**5.5 + 
     -         1.0270845918980587e12/(144 + r**2)**4.5 + 
     -         4.585199070973476e9/(144 + r**2)**3.5 + 
     -         2.1227773476729058e7/(144 + r**2)**2.5 + 
     -         85992.13792656448/(144 + r**2)**1.5))*
     -    Sqrt(-1 - (4*(4332.198668720216/
     -            (1 + 0.32653061224489793*r**2)**1.5 - 
     -           3.2460945126654697e12/(64 + r**2)**5.5 - 
     -           2.254232300462132e10/(64 + r**2)**4.5 - 
     -           2.264295837517766e8/(64 + r**2)**3.5 - 
     -           2.35864149741434e6/(64 + r**2)**2.5 - 
     -           21498.03448164112/(64 + r**2)**1.5 + 
     -           3.3277540777497106e14/(144 + r**2)**5.5 + 
     -           1.0270845918980587e12/(144 + r**2)**4.5 + 
     -           4.585199070973476e9/(144 + r**2)**3.5 + 
     -           2.1227773476729058e7/(144 + r**2)**2.5 + 
     -           85992.13792656448/(144 + r**2)**1.5))/
     -       (r**2*(-4243.786450991232/
     -            (1 + 0.32653061224489793*r**2)**2.5 + 
     -           3.5707039639320164e13/(64 + r**2)**6.5 + 
     -           2.0288090704159186e11/(64 + r**2)**5.5 + 
     -           1.5850070862624364e9/(64 + r**2)**4.5 + 
     -           1.1793207487071699e7/(64 + r**2)**3.5 + 
     -           64494.10344492335/(64 + r**2)**2.5 - 
     -           3.6605294855246815e15/(144 + r**2)**6.5 - 
     -           9.24376132708253e12/(144 + r**2)**5.5 - 
     -           3.2096393496814335e10/(144 + r**2)**4.5 - 
     -           1.061388673836453e8/(144 + r**2)**3.5 - 
     -           257976.41377969345/(144 + r**2)**2.5))))

        ENDFUNCTION
